<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flash Card App</title>

<style>

  body {
  font-family: Arial, sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: #f0f0f0;
  margin: 0;
}

.container {
  text-align: center;
}

.card {
  width: 300px;
  height: 200px;
  margin: 20px auto;
  perspective: 1000px;
  position: relative;
}

.card-inner {
  width: 100%;
  height: 100%;
  transition: transform 0.6s;
  transform-style: preserve-3d;
  position: relative;
}

.card.flipped .card-inner {
  transform: rotateY(180deg);
}

.front, .back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  background: white;
  border: 1px solid #ccc;
  padding: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-sizing: border-box;
}

.back {
  transform: rotateY(180deg);
}


.controls {
  margin-top: 10px;
}

button {
  margin: 0 5px;
  padding: 10px 20px;
  font-size: 16px;
}


</style>

</head>
<body>

  <div class="container">
    <div class="card">
      <div class="card-inner" id="flashcard">
        <div class="front">Question</div>
        <div class="back">Answer</div>
      </div>
    </div>

    <div class="controls">
      <button id="prevBtn">Previous</button>
      <button id="flipBtn">Flip</button>
      <button id="nextBtn">Next</button>
      <br>
      <br>
      <button id="addBtn">Add to Current Deck</button>
      <button id="createBtn">Create New Deck</button>
      <button onclick="saveFile()">Save Deck</button>
    </div>

  </div>


 
  <script>

    // Basic scaffold for flashcard behavior

let flashcards = [
   {question : "What is JavaScript?", answer: "A programming language for the web." },
   {question :"What is a closure?", answer:  "A function with preserved data from its lexical scope." }
  // Add more cards here
];
let currentIndex = 0;


const flashcardEl = document.getElementById('flashcard');
const frontEl = flashcardEl.querySelector('.front');
const backEl = flashcardEl.querySelector('.back');

function renderCard(index) {

  if ( flashcards.length === 0)
{

}

  const card = flashcards[index];
  frontEl.textContent = card.question;
  backEl.textContent = card.answer;
}

// Initial card render
renderCard(currentIndex);

document.getElementById('flipBtn').addEventListener('click', () => {
  document.querySelector('.card').classList.toggle('flipped');
});


document.getElementById('prevBtn').addEventListener('click', () => {
  // previous card logic
  // checks that index would stay in parameters 
  let tempIndex = currentIndex - 1;
  if(tempIndex >= 0)
{
    currentIndex--;
    renderCard(currentIndex);
}
 
});

document.getElementById('nextBtn').addEventListener('click', () => {
  // next card logic
  // checks that index would stay in parameters 
  let tempIndex = currentIndex + 1;
  if(tempIndex < flashcards.length)
{
    currentIndex++;
    renderCard(currentIndex);
}
  
});

document.getElementById('addBtn').addEventListener('click', () => {
  
  // probably a better way to do this but here we are 
  const addWordbox = document.createElement('input');
  const addWordLabel = document.createElement('label');
  const addDefbox = document.createElement('input');
  const addDefLabel = document.createElement('label');
  const submitAddBtn = document.createElement('button');
  const breakTag = document.createElement('br');
  const divTag = document.createElement('div');
  
  // word text box setup
  addWordLabel.textContent = 'Word';
  addWordbox.type = 'text';
  addWordbox.name = 'addWordCard';
  addWordLabel.id = 'addWordInfoLabel';
  addWordbox.id = 'addWordInfoBox';
  addWordLabel.style.margin = '10px';
  addWordbox.style.margin = '5px';
  

 
  document.querySelector('.container').appendChild(breakTag);
  document.querySelector('.container').appendChild(addWordLabel);
  document.querySelector('.container').appendChild(addWordbox);

     // definition text box setup
  addDefLabel.textContent = 'Definition';
  addDefbox.type = 'text';
  addDefbox.name = 'addDefCard';
  addDefLabel.id = 'addDefInfoLabel';
  addDefbox.id = 'addDefInfoBox';
  addDefLabel.style.margin = '10px';
  addDefbox.style.margin = '5px';

   
  document.querySelector('.container').appendChild(addDefLabel);
  document.querySelector('.container').appendChild(addDefbox);

  //submit button stuff
  submitAddBtn.type = 'submit';
  submitAddBtn.name = 'addCardBtn';
  submitAddBtn.id = 'addCardInfoBtn';
  submitAddBtn.textContent = 'add Card';
  submitAddBtn.style.margin = '5px';


  document.querySelector('.container').appendChild(divTag);
 
  
  
  document.querySelector('.container').appendChild(submitAddBtn);

  // event listener for the submit button 
  submitAddBtn.addEventListener('click', () => {
  
  const word = document.getElementById('addWordInfoBox').value;
  const definition = document.getElementById('addDefInfoBox').value;

  if (flashcards[0].question === "" && flashcards[0].answer === "")  
  {
    flashcards[0] = {question : word, answer : definition};
    renderCard(0);
  }
  else
  {
    flashcards.push({question : word, answer : definition});
  }
  
  
  
  });

});

let currentFileName = "FlashSaveTestingBAby";
// could have save button if are sending shit to a DB but don't know yet, don't know the JSON shit either 
 // puts the global 'flashcards' array into a json object (no name, just word : defintion)
        async function getFlashCardDeckJson() {
            return { content: flashcards };
        }

        async function saveFile() {
            console.log(`${currentFileName}`);
            /*
            if (!currentFileName) {
                openFileNameModal(saveFile);
                return;
            }
            */

            const token = await refreshToken();
            if (!token) {
                if (confirm('You need to login to save. Return to login screen?')) {
                window.location.href = 'index';
                }
                return;
            }
            
            const jsonData = await getFlashCardDeckJson();

            
            try {
                const response = await fetch('/assets', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },

                // The attributes of the json file we want to create
                body: JSON.stringify({
                    fileName: currentFileName, // object 1
                    fileType: "flash",
                    creatorName: "", // Fix so actual creator uif the file is new
                    dateCreated: new Date().toISOString(),  // !!! !!! !!! please fix so only when file is new
                    lastEdited: new Date().toISOString(),
                    lastEditor: "",
                    fileData: flashcards // object
                })
                });

                if (!response.ok) throw new Error(await response.text());

                alert(`Document saved as ${currentFileName}`);
            } catch (err) {
                alert(`Save failed: ${err.message}`);
            }
        }


        // Handling each request with checking the validity of the tokens and refreshing them as needed
        async function refreshToken() {
            try {
                const response = await fetch('/refresh', {
                method: 'GET',
                credentials: 'include'
                });
                if (!response.ok) throw new Error('Token refresh failed');
                const data = await response.json();
                return data.accessToken;
            } catch (err) {
                console.error('Token refresh failed:', err);
                return null;
            }
        }

        async function loadFileFromServer(fileName) {
            try {
                const token = await refreshToken();
                if (!token) {
                    if (confirm('Not logged in. Return to login screen?')) {
                        window.location.href = 'index';
                    }
                    return;
                }

                const response = await fetch(`/assets/${fileName}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error(`Failed to fetch file: ${response.statusText}`);

                const { fileName: returnedFileName, content } = await response.json();

                // Instead of calling undefined loadStyledContent:
                // Update the global cardList with loaded data
                flashcards = content.fileContent || content;

                
            } catch (err) {
                alert(`Error loading file: ${err.message}`);
            }
        }

        // Get the filename from url
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // When the dom completely loads, show file if it exists
        window.addEventListener('DOMContentLoaded', () => {
            const fileName = getQueryParam('file');
            if (fileName) {
                loadFileFromServer(fileName);
            }
        });



document.getElementById('createBtn').addEventListener('click', () => {
  
 flashcards.length = 0;

 flashcards.push({question: "", answer: ""});

 renderCard(0);
 


  
});






  </script>
</body>
</html>

<!-- <script>
    let flashcardList = []; // for studying 
    let tempList = []; // for changes
    //  need save button
    
</script> -->